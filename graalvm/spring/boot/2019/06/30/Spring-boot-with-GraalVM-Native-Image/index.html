<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Spring boot with GraalVM Native Image &#8211; Hakan Dilek</title>
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Building a Spring Boot project with GraalVM Native Images">
    <meta name="robots" content="all">
    <meta name="author" content="Hakan Dilek">
    
    <meta name="keywords" content="GraalVM, spring, boot">
    <link rel="canonical" href="http://www.dilek.me/graalvm/spring/boot/2019/06/30/Spring-boot-with-GraalVM-Native-Image/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for Hakan Dilek" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?201906301836" type="text/css">

    <!-- Fonts -->
    
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- MathJax -->
    

    <!-- Verifications -->
    
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Spring boot with GraalVM Native Image">
    <meta property="og:description" content="My personal blog">
    <meta property="og:url" content="http://www.dilek.me/graalvm/spring/boot/2019/06/30/Spring-boot-with-GraalVM-Native-Image/">
    <meta property="og:site_name" content="Hakan Dilek">
    

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    
        <meta name="twitter:site" content="@panikyok" />
        <meta name="twitter:creator" content="@panikyok" />
    
    <meta name="twitter:title" content="Spring boot with GraalVM Native Image" />
    <meta name="twitter:description" content="Building a Spring Boot project with GraalVM Native Images" />
    <meta name="twitter:url" content="http://www.dilek.me/graalvm/spring/boot/2019/06/30/Spring-boot-with-GraalVM-Native-Image/" />
    

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="shortcut icon" href="/favicon.ico">

    
    <script type="text/javascript">
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       ga('create', 'UA-60180717-1', 'auto');
       ga('send', 'pageview');
    </script>
    
</head>

<body class="site animated fade-in-down">
  
	

  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="/" class="site-title">Hakan Dilek</a>
      <nav class="site-nav">
        



    
    
    
    
        <a class="nav-link" href="/about/">About Me</a>
    

    

    
    
    
    
        <a class="nav-link" href="/contact/">Say Hello</a>
    

    


      </nav>
      <div class="clearfix"></div>
      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>Spring boot with GraalVM Native Image</h1>
  <span class="post-meta">Jun 30, 2019</span><br>
  
  <span class="post-meta small">
  
    3 minute read
  
  </span>
</div>

<article class="post-content">
  <h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li><a href="https://github.com/oracle/graal/releases">GraalVM is installed</a> and <code class="highlighter-rouge">&lt;GraalVM&gt;/bin</code> directory is in the <code class="highlighter-rouge">$PATH</code></li>
  <li><a href="https://www.graalvm.org/docs/reference-manual/aot-compilation/">Native Image</a> is installed using the command <code class="highlighter-rouge">gu install native-image</code></li>
  <li>Clone the <a href="https://github.com/hakandilek/graalvm-playground">graalvm-playground repository</a></li>
</ul>

<h2 id="run-in-the-vm">Run in the VM</h2>

<ul>
  <li>
    <p>For convenience first run the example in the local JVM:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span><span class="nb">cd </span>graalvm-playground/spring-web
  <span class="nv">$.</span>/gradlew clean bootJar <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="nb">time </span>java <span class="nt">-jar</span> build/libs/spring-web-0.0.1-SNAPSHOT.jar

  BUILD SUCCESSFUL <span class="k">in </span>1s
  4 actionable tasks: 4 executed

    <span class="nb">.</span>   ____          _            __ _ _
  /<span class="se">\\</span> / ___<span class="s1">'_ __ _ _(_)_ __  __ _ \ \ \ \
  ( ( )\___ | '</span>_ | <span class="s1">'_| | '</span>_ <span class="se">\/</span> _<span class="sb">`</span> | <span class="se">\ \ \ \</span>
  <span class="se">\\</span>/  ___<span class="o">)</span>| |_<span class="o">)</span>| | | | | <span class="o">||</span> <span class="o">(</span>_| |  <span class="o">)</span> <span class="o">)</span> <span class="o">)</span> <span class="o">)</span>
    <span class="s1">'  |____| .__|_| |_|_| |_\__, | / / / /
  =========|_|==============|___/=/_/_/_/
  :: Spring Boot ::        (v2.1.5.RELEASE)

  2019-05-23 23:19:27.344  INFO 27401 --- [           main] me.dilek.graalvm.demo.DemoApplication    : Starting DemoApplication on l380 with PID 27401 (/home/XXX/graalvm-playground/spring-web/build/libs/spring-web-0.0.1-SNAPSHOT.jar started by XXX in /home/XXX/graalvm-playground/spring-web)
  2019-05-23 23:19:27.347  INFO 27401 --- [           main] me.dilek.graalvm.demo.DemoApplication    : No active profile set, falling back to default profiles: default
  2019-05-23 23:19:28.456  INFO 27401 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8081 (http)
  2019-05-23 23:19:28.493  INFO 27401 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
  2019-05-23 23:19:28.493  INFO 27401 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.19]
  2019-05-23 23:19:28.592  INFO 27401 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
  2019-05-23 23:19:28.593  INFO 27401 --- [           main] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1197 ms
  2019-05-23 23:19:28.925  INFO 27401 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService '</span>applicationTaskExecutor<span class="s1">'
  2019-05-23 23:19:29.169  INFO 27401 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8081 (http) with context path ''
  2019-05-23 23:19:29.171  INFO 27401 --- [           main] me.dilek.graalvm.demo.DemoApplication    : Started DemoApplication in 2.194 seconds (JVM running for 2.633)

</span></code></pre></div>    </div>
  </li>
</ul>

<h2 id="build-native-image">Build Native Image</h2>

<ul>
  <li>
    <p>Make sure that you have the right JVM version (Currently most recent supported version is JDK8-u212):</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>javac <span class="nt">-version</span>
javac 1.8.0_212
</code></pre></div>    </div>
  </li>
  <li>
    <p>Try to build the native image</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>./gradlew clean bootJar <span class="o">&amp;&amp;</span> <span class="se">\</span>
    native-image <span class="nt">-jar</span> build/libs/spring-web-0.0.1-SNAPSHOT.jar

  BUILD SUCCESSFUL <span class="k">in </span>0s
  4 actionable tasks: 4 executed
  Build on Server<span class="o">(</span>pid: 4674, port: 34081<span class="o">)</span>
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]    classlist:     265.01 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]        <span class="o">(</span>cap<span class="o">)</span>:     919.46 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]        setup:   1,221.87 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]     analysis:   4,072.66 ms
  Warning: Aborting stand-alone image build. com.oracle.svm.hosted.substitute.DeletedElementException: Unsupported field java.net.URL.handlers is reachable
  To diagnose the issue, you can add the option <span class="nt">--report-unsupported-elements-at-runtime</span><span class="nb">.</span> The unsupported element is <span class="k">then </span>reported at run <span class="nb">time </span>when it is accessed the first time.
  Detailed message:
  Trace: 
    at parsing java.net.URL.setURLStreamHandlerFactory<span class="o">(</span>URL.java:1118<span class="o">)</span>
  Call path from entry point to java.net.URL.setURLStreamHandlerFactory<span class="o">(</span>URLStreamHandlerFactory<span class="o">)</span>: 
    at java.net.URL.setURLStreamHandlerFactory<span class="o">(</span>URL.java:1110<span class="o">)</span>
    at org.springframework.boot.loader.jar.JarFile.resetCachedUrlHandlers<span class="o">(</span>JarFile.java:401<span class="o">)</span>
    at org.springframework.boot.loader.jar.JarFile.registerUrlProtocolHandler<span class="o">(</span>JarFile.java:391<span class="o">)</span>
    at org.springframework.boot.loader.Launcher.launch<span class="o">(</span>Launcher.java:48<span class="o">)</span>
    at org.springframework.boot.loader.JarLauncher.main<span class="o">(</span>JarLauncher.java:51<span class="o">)</span>
    at com.oracle.svm.core.JavaMainWrapper.run<span class="o">(</span>JavaMainWrapper.java:153<span class="o">)</span>
    at com.oracle.svm.core.code.IsolateEnterStub.JavaMainWrapper_run_5087f5482cc9a6abc971913ece43acb471d2631b<span class="o">(</span>generated:0<span class="o">)</span>

  Warning: Use <span class="nt">-H</span>:+ReportExceptionStackTraces to print stacktrace of underlying exception
  Build on Server<span class="o">(</span>pid: 4674, port: 34081<span class="o">)</span>
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]    classlist:     114.69 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]        <span class="o">(</span>cap<span class="o">)</span>:     642.22 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]        setup:     896.36 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]   <span class="o">(</span>typeflow<span class="o">)</span>:   1,503.32 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]    <span class="o">(</span>objects<span class="o">)</span>:     705.94 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]   <span class="o">(</span>features<span class="o">)</span>:      98.03 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]     analysis:   2,358.07 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]     <span class="o">(</span>clinit<span class="o">)</span>:      64.41 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]     universe:     202.79 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]      <span class="o">(</span>parse<span class="o">)</span>:     205.68 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]     <span class="o">(</span>inline<span class="o">)</span>:     586.94 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]    <span class="o">(</span>compile<span class="o">)</span>:   1,422.75 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]      compile:   2,394.41 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]        image:     245.09 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]        write:      56.23 ms
  <span class="o">[</span>spring-web-0.0.1-SNAPSHOT:4674]      <span class="o">[</span>total]:   6,324.13 ms
  Warning: Image <span class="s1">'spring-web-0.0.1-SNAPSHOT'</span> is a fallback image that requires a JDK <span class="k">for </span>execution <span class="o">(</span>use <span class="nt">--no-fallback</span> to suppress fallback image generation<span class="o">)</span><span class="nb">.</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Check the resulting image:</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ahl</span>
  ...
  <span class="nt">-rwxr-xr-x</span> 1 XXX XXX 2,6M Mai 23 23:22 spring-web-0.0.1-SNAPSHOT
  ...
</code></pre></div>    </div>

    <p>The resulting image requires a Java for execution!</p>
  </li>
  <li>
    <p>Run the native image</p>

    <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./spring-web-0.0.1-SNAPSHOT&amp; ps <span class="nt">-ef</span> | <span class="nb">grep </span>java
  <span class="o">[</span>1] 28883
  XXX    28883  5089  0 23:31 pts/1    00:00:00 /home/XXX/tools/graalvm-ce-19.0.0/jre/bin/java <span class="nt">-Dorg</span>.graalvm.nativeimage.kind<span class="o">=</span>fallback-executable <span class="nt">-cp</span> /home/XXX/mutfak/graalvm-playground/spring-web/build/libs/spring-web-0.0.1-SNAPSHOT.jar org.springframework.boot.loader.JarLauncher
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>The resulting image is not a real native image and needs a JRE to run. This is already indicated ruting native image build phase with the message <code class="highlighter-rouge">Warning: Aborting stand-alone image build. com.oracle.svm.hosted.substitute.DeletedElementException: Unsupported field java.net.URL.handlers is reachable</code>.</p>

<p>The reason is, current version of Spring 5.1 does not support GraalVM native images but the upcoming versions with 5.2 and 5.3 will mainly focus on supporting native images as mentioned <a href="https://github.com/spring-projects/spring-framework/wiki/GraalVM-native-image-support#support-of-native-images-at-spring-framework-level">here</a> and <a href="https://github.com/spring-projects/spring-framework/issues/21529#issuecomment-453474115">here</a></p>

</article>


  <div class="share-page">
  Share this post!

  <div class="share-links">
    

    
      <a class="fa fa-twitter" href="https://twitter.com/intent/tweet?text=Spring+boot+with+GraalVM+Native+Image&amp;url=http%3A%2F%2Fwww.dilek.me%2Fgraalvm%2Fspring%2Fboot%2F2019%2F06%2F30%2FSpring-boot-with-GraalVM-Native-Image%2F" rel="nofollow" target="_blank" title="Share on Twitter"></a>
    

    

    
      <a class="fa fa-linkedin" href="http://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.dilek.me%2Fgraalvm%2Fspring%2Fboot%2F2019%2F06%2F30%2FSpring-boot-with-GraalVM-Native-Image%2F&amp;title=Spring+boot+with+GraalVM+Native+Image" rel="nofollow" target="_blank" title="Share on LinkedIn"></a>
    

    

    

    

    

    
      <a class="fa fa-hacker-news" onclick="parent.postMessage('submit','*')" href="https://news.ycombinator.com/submitlink?u=http%3A%2F%2Fwww.dilek.me%2Fgraalvm%2Fspring%2Fboot%2F2019%2F06%2F30%2FSpring-boot-with-GraalVM-Native-Image%2F&amp;t=Spring+boot+with+GraalVM+Native+Image" rel="nofollow" target="_blank" title="Share on Hacker News"></a>
    
  </div>
</div>




  <div class="py2 post-footer">
  <img src="/images/me.jpeg" alt="Hakan Dilek" class="avatar" />
  <p>
    <a href="http://dilek.me">Hakan Dilek</a> is a software engineer living in Germany.
  </p>
  <p>
    Follow him on <a href="https://twitter.com/panikyok">Twitter</a>.
  </p>
</div>




  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname  = 'dilekme';
    var disqus_identifier = '/graalvm/spring/boot/2019/06/30/Spring-boot-with-GraalVM-Native-Image';
    var disqus_title      = "Spring boot with GraalVM Native Image";

    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






      </div>
    </div>
  </div>

  <footer class="center">
  <div class="measure">
    <small>
        Crafted with &lt;3 by <a href="http://dilek.me">Hakan Dilek</a> (<a
          href="https://twitter.com/panikyok">@panikyok</a>).<br>
        &lt;/&gt; available on <a href="https://github.com/hakandilek/dilek.me">Github</a>.
    </small>
  </div>
</footer>

<script type="text/javascript">
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/sw.js")
    }
</script>

</body>
</html>
